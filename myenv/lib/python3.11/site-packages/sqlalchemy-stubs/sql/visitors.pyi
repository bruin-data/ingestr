from typing import Any
from typing import Callable
from typing import Dict
from typing import Iterable
from typing import Iterator
from typing import List
from typing import Optional
from typing import TypeVar

from ..util import langhelpers

_ET = TypeVar("_ET", bound=ExternalTraversal)
_T = TypeVar("_T")

class TraversibleType(type):
    def __init__(cls, clsname: Any, bases: Any, clsdict: Any) -> None: ...

class Traversible(metaclass=TraversibleType): ...

class _InternalTraversalType(type):
    def __init__(cls, clsname: Any, bases: Any, clsdict: Any) -> None: ...

class InternalTraversal(object, metaclass=_InternalTraversalType):
    def dispatch(self, visit_symbol: Any) -> Optional[Callable[..., Any]]: ...
    def run_generated_dispatch(
        self,
        target: Any,
        internal_dispatch: Any,
        generate_dispatcher_name: Any,
    ) -> Any: ...
    def generate_dispatch(
        self,
        target_cls: Any,
        internal_dispatch: Any,
        generate_dispatcher_name: Any,
    ) -> Any: ...
    dp_has_cache_key: langhelpers.TypingSymbol = ...
    dp_has_cache_key_list: langhelpers.TypingSymbol = ...
    dp_clauseelement: langhelpers.TypingSymbol = ...
    dp_fromclause_canonical_column_collection: langhelpers.TypingSymbol = ...
    dp_clauseelement_tuples: langhelpers.TypingSymbol = ...
    dp_clauseelement_list: langhelpers.TypingSymbol = ...
    dp_clauseelement_tuple: langhelpers.TypingSymbol = ...
    dp_executable_options: langhelpers.TypingSymbol = ...
    dp_fromclause_ordered_set: langhelpers.TypingSymbol = ...
    dp_string: langhelpers.TypingSymbol = ...
    dp_string_list: langhelpers.TypingSymbol = ...
    dp_anon_name: langhelpers.TypingSymbol = ...
    dp_boolean: langhelpers.TypingSymbol = ...
    dp_operator: langhelpers.TypingSymbol = ...
    dp_type: langhelpers.TypingSymbol = ...
    dp_plain_dict: langhelpers.TypingSymbol = ...
    dp_dialect_options: langhelpers.TypingSymbol = ...
    dp_string_clauseelement_dict: langhelpers.TypingSymbol = ...
    dp_string_multi_dict: langhelpers.TypingSymbol = ...
    dp_annotations_key: langhelpers.TypingSymbol = ...
    dp_plain_obj: langhelpers.TypingSymbol = ...
    dp_named_ddl_element: langhelpers.TypingSymbol = ...
    dp_prefix_sequence: langhelpers.TypingSymbol = ...
    dp_table_hint_list: langhelpers.TypingSymbol = ...
    dp_setup_join_tuple: langhelpers.TypingSymbol = ...
    dp_statement_hint_list: langhelpers.TypingSymbol = ...
    dp_unknown_structure: langhelpers.TypingSymbol = ...
    dp_dml_ordered_values: langhelpers.TypingSymbol = ...
    dp_dml_values: langhelpers.TypingSymbol = ...
    dp_dml_multi_values: langhelpers.TypingSymbol = ...
    dp_propagate_attrs: langhelpers.TypingSymbol = ...

class ExtendedInternalTraversal(InternalTraversal):
    dp_ignore: langhelpers.TypingSymbol = ...
    dp_inspectable: langhelpers.TypingSymbol = ...
    dp_multi: langhelpers.TypingSymbol = ...
    dp_multi_list: langhelpers.TypingSymbol = ...
    dp_has_cache_key_tuples: langhelpers.TypingSymbol = ...
    dp_inspectable_list: langhelpers.TypingSymbol = ...

class ExternalTraversal:
    __traverse_options__: Any = ...
    def traverse_single(self, obj: Any, **kw: Any) -> Any: ...
    def iterate(self, obj: Any) -> Iterator[Any]: ...
    def traverse(self, obj: _T) -> _T: ...
    @property
    def visitor_iterator(self) -> Iterator[Any]: ...
    def chain(self: _ET, visitor: Any) -> _ET: ...

class CloningExternalTraversal(ExternalTraversal):
    def copy_and_process(self, list_: Iterable[_T]) -> List[_T]: ...
    def traverse(self, obj: _T) -> _T: ...

class ReplacingExternalTraversal(CloningExternalTraversal):
    def replace(self, elem: Any) -> Optional[Any]: ...
    def traverse(self, obj: _T) -> _T: ...

Visitable = Traversible
VisitableType = TraversibleType
ClauseVisitor = ExternalTraversal
CloningVisitor = CloningExternalTraversal
ReplacingCloningVisitor = ReplacingExternalTraversal

def iterate(obj: Any, opts: Dict[str, Any] = ...) -> Iterator[Any]: ...
def traverse_using(
    iterator: Iterator[Any], obj: _T, visitors: Dict[str, Callable[..., Any]]
) -> _T: ...
def traverse(
    obj: _T, opts: Dict[str, Any], visitors: Dict[str, Callable[..., Any]]
) -> _T: ...
def cloned_traverse(
    obj: _T, opts: Dict[str, Any], visitors: Dict[str, Callable[..., Any]]
) -> _T: ...
def replacement_traverse(
    obj: _T, opts: Dict[str, Any], replace: Callable[[Any], Any]
) -> _T: ...
